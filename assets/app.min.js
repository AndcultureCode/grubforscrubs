(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.grubforscrubs=window.grubforscrubs||{},window.grubforscrubs.views=window.grubforscrubs.views||{}}).call(this),pledgeit.services.LeaderboardService=function(){function t(){this._initialize()}return t.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/widgets/campaigns",_templateEndpoint:"https://pledgeit.org/api-public/widgets/templates",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var s=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>s.length)&&(e=s.length),e-=t.length;var n=s.indexOf(t,e);return-1!==n&&n===e})},getCampaign:function(t,e){this._makeRequest(this._campaignEndpoint+"/"+t,e)},getTemplate:function(t,e){this._makeRequest(this._templateEndpoint+"/"+t,e)},_makeRequest:function(t,s){$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:t,success:function(t){var e=t;s.onSuccess&&s.onSuccess(e)}})}},t}(),function(s){s.fn.reOrder=function(e){return this.each(function(){if(e){for(var t=0;t<e.length;t++)e[t]=s('[gs-name="'+e[t]+'"]');s(this).empty();for(t=0;t<e.length;t++)s(this).append(e[t])}})}}(jQuery);var services=pledgeit.services,views=grubforscrubs.views;grubforscrubs.views.MainView=function(){function t(){this._initialize(),this._attachEvents()}return t.prototype={_$stats:null,_$tabpanels:null,_leaderboardService:null,_initialize:function(){this._$stats=$("[gs-total]"),this._$tabpanels=$('[role="tabpanel"]'),this._leaderboardService=new services.LeaderboardService,this._sortRestaurants(),this._getStats(),this._getRestaurants(),window.Selectize&&$("select[selectize]").each($.proxy(function(t,e){$(e).selectize({onChange:$.proxy(this._handleSortChange,this,e)})},this))},_attachEvents:function(){$('[role="tablist"]').on("click","a",$.proxy(this._handleTabClick,this))},_getStats:function(){this._leaderboardService.getTemplate("grub-for-scrubs-hbg",{onSuccess:$.proxy(function(t){this._$stats.text("$"+t.amountRaised.substring(0,t.amountRaised.indexOf("."))).removeClass("-preload")},this)})},_getRestaurants:function(){$("[gs-slug]").each($.proxy(function(t,a){this._leaderboardService.getCampaign(a.getAttribute("gs-slug"),{onSuccess:function(i){$target=$(a),$target.find("[gs-amount]").text("$"+i.amountRaised.substring(0,i.amountRaised.indexOf("."))).removeClass("-preload"),$target.find("[gs-message]").text(function(){var t=Number(a.getAttribute("gs-deliveries")),e=Number(i.amountRaised.substring(0,i.amountRaised.indexOf(".")).replace(/,/g,"")),s=Number(a.getAttribute("gs-goal")),n=(e-s*Math.floor(e/s))/s;return 0===e?"Be the first!":Math.floor(e/s)>t?"Awaiting Delivery!":0<t&&0==n?"Let's do it again!":n<.49?"Great start!":n<1?"Almost there!":void 0}).removeClass("-preload"),$target.find("[gs-donate]").attr("href",i.url+"/donate").removeClass("-preload")}})},this))},_getSort:function(t,e){var s=e.find("[gs-name]").map(function(t,e){return{amount:parseFloat($(e).find("[gs-amount]").text().replace(/[,\$]/g,"")),name:e.getAttribute("gs-name")}});switch(s.sort(function(t,e){var s=t.name.toLowerCase(),n=e.name.toLowerCase();return s<n?-1:n<s?1:0}),t){case"high":s.sort(function(t,e){return e.amount-t.amount});break;case"low":s.sort(function(t,e){return t.amount-e.amount})}return s.map(function(t,e){return e.name})},_sortRestaurants:function(){$("[gs-restaurants]").each($.proxy(function(t,e){$list=$(e),$list.reOrder(this._getSort("alpha",$list)),$list.removeClass("-preload")},this))},_handleRestaurantSuccess:function(t,e){e.find("[gs-amount]").text("$"+t.amountRaised).removeClass("-preload")},_handleStatSuccess:function(t,e){e.text("$"+t.amountRaised).removeClass("-preload")},_handleSortChange:function(t,e){$list=$(t).closest("section").find("[gs-restaurants]"),$list.reOrder(this._getSort(e,$list))},_handleTabClick:function(t){t.preventDefault(),$target=$(t.currentTarget),$target.attr("aria-selected",!0).addClass("-selected"),$siblings=$target.siblings(),$siblings.attr("aria-selected",!1).removeClass("-selected"),this._$tabpanels.filter(function(t,e){return $(e).hasClass("-selected")}).removeClass("-selected"),this._$tabpanels.filter(function(t,e){return"#"+e.id===$target.attr("href")}).addClass("-selected")}},t}(),$(function(){new grubforscrubs.views.MainView});