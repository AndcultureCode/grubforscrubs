(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.grubforscrubs=window.grubforscrubs||{},window.grubforscrubs.views=window.grubforscrubs.views||{}}).call(this),pledgeit.services.LeaderboardService=function(){function t(){this._initialize()}return t.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/widgets/campaigns",_templateEndpoint:"https://pledgeit.org/api-public/widgets/templates",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var i=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>i.length)&&(e=i.length),e-=t.length;var s=i.indexOf(t,e);return-1!==s&&s===e})},getCampaign:function(t,e){this._makeRequest(this._campaignEndpoint+"/"+t,e)},getTemplate:function(t,e){this._makeRequest(this._templateEndpoint+"/"+t,e)},_makeRequest:function(t,i){$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:t,success:function(t){var e=t;i.onSuccess&&i.onSuccess(e)}})}},t}();var services=pledgeit.services,views=grubforscrubs.views;grubforscrubs.views.MainView=function(){function t(){this._initialize()}return t.prototype={_$stats:null,_$restaurants:null,_leaderboardService:null,_initialize:function(){this._$stats=$("[gs-total]"),this._$restaurants=$("[gs-restaurants]"),this._leaderboardService=new services.LeaderboardService,this._getStats(),this._getRestaurants()},_getStats:function(){this._leaderboardService.getTemplate("grub-for-scrubs-hbg",{onSuccess:$.proxy(function(t){this._$stats.text("$"+t.amountRaised).removeClass("-preload")},this)})},_getRestaurants:function(){this._$restaurants.find("[gs-slug]").each($.proxy(function(t,e){this._leaderboardService.getCampaign(e.getAttribute("gs-slug"),{onSuccess:function(t){$target=$(e),$target.find("[gs-amount]").text("$"+t.amountRaised).removeClass("-preload"),$target.find("[gs-donate]").attr("href",t.url+"/donate").removeClass("-preload")}})},this))},_handleRestaurantSuccess:function(t,e){e.find("[gs-amount]").text("$"+t.amountRaised).removeClass("-preload")},_handleStatSuccess:function(t,e){e.text("$"+t.amountRaised).removeClass("-preload")}},t}(),$(function(){new grubforscrubs.views.MainView});