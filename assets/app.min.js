(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.grubforscrubs=window.grubforscrubs||{},window.grubforscrubs.views=window.grubforscrubs.views||{},window.grubforscrubs.templates=window.grubforscrubs.templates||{}}).call(this),pledgeit.services.LeaderboardService=function(){function e(){this._initialize()}return e.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/campaigns/stats?tags=program:cvc20",_leaderboardEndpoint:"https://pledgeit.org/api-public/partners/acs/cvc20/leaderboard?",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var s=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>s.length)&&(t=s.length),t-=e.length;var r=s.indexOf(e,t);return-1!==r&&r===t})},getLeaderboard:function(e){this._makeRequest(this._leaderboardEndpoint,e,!0)},getStats:function(e){var t=this._campaignEndpoint;this._makeRequest(t,e,!0)},_makeRequest:function(e,s,r){e+="",(r=null!=r&&r)&&(s.type&&(e+=s.type+"?"),s.limit&&(e+="limit="+s.limit.toString()+"&"),s.name&&(e+="school_name="+s.name.toString()+"&"),s.level&&(e+="level="+s.level+"&"),s.rankBy&&(e+="rankBy="+s.rankBy+"&"),s.skip&&(e+="skip="+s.skip+"&"),s.tags&&(e+="tags="+s.tags.toString())),e.endsWith("?")&&(e=e.slice(0,-1)),$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:e,success:function(e){var t=e;!r&&t.length&&(t=t.slice(0,s.limit)),s.onSuccess&&s.onSuccess(t)}})}},e}(),this.grubforscrubs=this.grubforscrubs||{},this.grubforscrubs.templates=this.grubforscrubs.templates||{},this.grubforscrubs.templates.leaderboard=Handlebars.template({1:function(e,t,s,r,a,n){var i,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(i=o(s,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"items"):t,{name:"each",hash:{},fn:e.program(2,a,1,n),inverse:e.noop,data:a,blockParams:n,loc:{start:{line:2,column:0},end:{line:12,column:9}}}))?i:""},2:function(e,t,s,r,a,n){var i,o=e.lambda,l=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="restaurant">\r\n    <div class="restaurant-logo">\r\n        <img src="'+l(o(null!=(i=null!=(i=n[0][0])?c(i,"avatar"):i)?c(i,"secure_url"):i,t))+'" class="c-leaderboard__column__logo" alt="'+l(o(null!=(i=n[0][0])?c(i,"school_name"):i,t))+' Logo">\r\n    </div>\r\n    <h3 class="restaurant-name">'+l(o(null!=(i=n[0][0])?c(i,"school_name"):i,t))+'</h3>\r\n    <label class="restaurant-raised">'+l(o(null!=(i=n[0][0])?c(i,"totalRaised"):i,t))+'</label>\r\n    <a class="button" href="'+l(o(null!=(i=n[0][0])?c(i,"url"):i,t))+"/fundraise\" target=\"_blank\"\r\n        onclick=\"gtag('event', 'click', {'event_category': 'Donate Button', 'event_label': '"+l(o(null!=(i=n[0][0])?c(i,"school_name"):i,t))+"'});\">Donate</a>\r\n</li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,s,r,a,n){var i,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(i=o(s,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"items"):t,{name:"if",hash:{},fn:e.program(1,a,0,n),inverse:e.noop,data:a,blockParams:n,loc:{start:{line:1,column:0},end:{line:13,column:7}}}))?i:""},useData:!0,useBlockParams:!0});var services=pledgeit.services,templates=grubforscrubs.templates,views=grubforscrubs.views;grubforscrubs.views.MainView=function(){function e(){this._initialize()}return e.prototype={_$stats:null,_$restaurants:null,_leaderboardService:null,_initialize:function(){this._$stats=$("[gs-total]"),this._$restaurants=$("[gs-restaurants]"),this._leaderboardService=new services.LeaderboardService,this._getStats(),this._getRestaurants()},_getStats:function(){this._leaderboardService.getStats({onSuccess:$.proxy(this._handleStatsSuccess,this)})},_getRestaurants:function(){pageSize=void 0,limit=void 0,skip=void 0,size=void 0,this._leaderboardService.getLeaderboard({name:"",level:"college",onSuccess:$.proxy(this._handleRestaurantSuccess.bind(this),this),rankBy:this._sort})},_handleRestaurantSuccess:function(e){e.forEach(function(e,t){fundsRaised=e.stats.overall.estimated_amount_raised,e.rank=t+1+skip,e.totalRaised=parseFloat((fundsRaised/100).toFixed(0)).toLocaleString("en-US",{style:"currency",maximumFractionDigits:2,currency:"USD"}),e.totalRaised=e.totalRaised.substring(0,e.totalRaised.indexOf(".")),e.name=e.school_name}),this._$restaurants.html(templates.leaderboard({items:e}))},_handleStatsSuccess:function(e){if(e.performance_metrics){var t=e.overall.estimated_amount_raised,s=parseFloat((t/100).toFixed(0)).toLocaleString("en-US",{style:"currency",maximumFractionDigits:2,currency:"USD"}),r={totalRaised:s.substring(0,s.indexOf("."))};this._$stats.text(r.totalRaised).removeClass("-preload")}}},e}(),$(function(){new grubforscrubs.views.MainView});