(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.grubforscrubs=window.grubforscrubs||{},window.grubforscrubs.views=window.grubforscrubs.views||{}}).call(this),pledgeit.services.LeaderboardService=function(){function e(){this._initialize()}return e.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/widgets/campaigns",_templateEndpoint:"https://pledgeit.org/api-public/widgets/templates",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;var s=i.indexOf(e,t);return-1!==s&&s===t})},getCampaign:function(e,t){this._makeRequest(this._campaignEndpoint+"/"+e,t)},getTemplate:function(e,t){this._makeRequest(this._templateEndpoint+"/"+e,t)},_makeRequest:function(e,i){$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:e,success:function(e){var t=e;i.onSuccess&&i.onSuccess(t)}})}},e}();var services=pledgeit.services,views=grubforscrubs.views;grubforscrubs.views.MainView=function(){function e(){this._initialize()}return e.prototype={_$stats:null,_leaderboardService:null,_initialize:function(){this._$stats=$("[gs-total]"),this._leaderboardService=new services.LeaderboardService,this._getStats(),this._getRestaurants()},_getStats:function(){this._leaderboardService.getTemplate("grub-for-scrubs-hbg",{onSuccess:$.proxy(function(e){this._$stats.text("$"+e.amountRaised.substring(0,e.amountRaised.indexOf("."))).removeClass("-preload")},this)})},_getRestaurants:function(){$("[gs-slug]").each($.proxy(function(e,t){this._leaderboardService.getCampaign(t.getAttribute("gs-slug"),{onSuccess:function(e){$target=$(t),$target.find("[gs-amount]").text("$"+e.amountRaised.substring(0,e.amountRaised.indexOf("."))).removeClass("-preload"),$target.find("[gs-donate]").attr("href",e.url+"/donate").removeClass("-preload")}})},this))},_handleRestaurantSuccess:function(e,t){t.find("[gs-amount]").text("$"+e.amountRaised).removeClass("-preload")},_handleStatSuccess:function(e,t){t.text("$"+e.amountRaised).removeClass("-preload")}},e}(),$(function(){new grubforscrubs.views.MainView});